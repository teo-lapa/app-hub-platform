================================================================================
DIAGNOSI: Perché "DGD Gastro GmbH" non viene trovato dalla ricerca
================================================================================

Data: 2025-11-10
Autore: Claude Code Agent

================================================================================
PROBLEMA IDENTIFICATO
================================================================================

"DGD Gastro GmbH" ha customer_rank = 0, quindi viene BLOCCATO dal filtro
customer_rank > 0 nella ricerca clienti.

Dati completi "DGD Gastro GmbH" (ID: 10136):
- Nome: DGD Gastro GmbH
- customer_rank: 0  ← PROBLEMA QUI!
- is_company: true
- type: contact
- active: true
- team_id: I Campioni del Gusto
- email: info@pizza-amore.ch
- city: Rüschlikon

================================================================================
IMPATTO TOTALE
================================================================================

⚠️  ATTENZIONE: Non è solo "DGD Gastro GmbH" ad essere bloccato!

Database Odoo completo:
- 3360 clienti TOTALI hanno customer_rank = 0
- Tutti questi clienti sono INVISIBILI nella ricerca attuale
- Include sia aziende che contatti registrati ma mai usati

Campione analizzato (primi 100):
- 29 Aziende bloccate
- 71 Contatti bloccati
- 85% senza team assegnato

Esempi di clienti bloccati:
- DGD Gastro GmbH (Rüschlikon)
- A TAVOLA JEANNERET (Peseux)
- ADA Gastro GmbH (Rickenbach)
- ACCADEMIA DEL GUSTO GMBH (Zürich)
- E altri 3356 clienti...

================================================================================
CAUSA ROOT
================================================================================

"DGD Gastro GmbH" è un'AZIENDA ma non ha mai effettuato ordini, quindi:
- customer_rank = 0 (non è considerato "cliente attivo")
- Il filtro customer_rank > 0 nell'API /api/clienti/search lo esclude

Questo vale per TUTTI i 3360 clienti con customer_rank = 0.

================================================================================
SOLUZIONE IMMEDIATA
================================================================================

File: C:\Users\lapa\OneDrive\Desktop\Claude Code\app\api\clienti\search\route.ts
Riga: 114

PRIMA:
------
['customer_rank', '>', 0],  // Solo clienti (non fornitori)

DOPO:
-----
// Rimuovere completamente questa riga

Oppure (alternativa):
---------------------
['customer_rank', '>=', 0],  // Include anche clienti senza ordini

================================================================================
IMPATTO DELLA FIX
================================================================================

✅ "DGD Gastro GmbH" diventerà ricercabile
✅ Altri 3359 clienti diventeranno visibili
✅ Sarà possibile aggiungere nuovi clienti al catalogo anche se non hanno mai ordinato
⚠️  La lista dei risultati potrebbe includere clienti mai usati (filtro opzionale consigliato)

================================================================================
RISULTATI TEST DIAGNOSTICI
================================================================================

TEST 1: Ricerca BASE - Solo nome "DGD"
Domain: [['name', 'ilike', 'DGD']]
Risultato: ✅ 3 record trovati

TEST 2: Ricerca con customer_rank > 0
Domain: [['name', 'ilike', 'DGD'], ['customer_rank', '>', 0]]
Risultato: ❌ 0 record trovati
DIAGNOSI: Il filtro customer_rank > 0 BLOCCA il risultato

TEST 3: Ricerca con is_company = true
Domain: [['name', 'ilike', 'DGD'], ['is_company', '=', true]]
Risultato: ✅ 1 record trovato

TEST 4: Ricerca con type = 'contact'
Domain: [['name', 'ilike', 'DGD'], ['type', '=', 'contact']]
Risultato: ✅ 1 record trovato

TEST 5: Domain COMPLESSO (API route attuale)
Domain: Complesso con customer_rank > 0 all'inizio
Risultato: ❌ 0 record trovati
DIAGNOSI: Il filtro customer_rank > 0 BLOCCA tutti i risultati

================================================================================
QUERY CORRETTA PER TROVARE "DGD Gastro GmbH"
================================================================================

// Ricerca minimalista (solo nome)
[
  ['name', 'ilike', 'DGD'],
  ['is_company', '=', true]
]

// Oppure ricerca SENZA filtro customer_rank
[
  // NESSUN filtro customer_rank (rimuovere riga 114)

  '|',
    ['is_company', '=', true],
    '&',
      ['is_company', '=', false],
      ['type', '=', 'contact'],

  '|', '|', '|', '|',
  ['name', 'ilike', query],
  ['email', 'ilike', query],
  ['phone', 'ilike', query],
  ['mobile', 'ilike', query],
  ['city', 'ilike', query]
]

================================================================================
FILE GENERATI
================================================================================

1. diagnosi-dgd-gastro-v2.js (17KB)
   Script diagnostico completo per "DGD Gastro GmbH"

2. DIAGNOSI_DGD_GASTRO.json (1.2MB)
   Dati completi di tutte le ricerche

3. trova-altri-clienti-bloccati.js (5.3KB)
   Script per trovare tutti i clienti con customer_rank = 0

4. CLIENTI_BLOCCATI_customer_rank_0.json (45KB)
   Lista dei primi 100 clienti bloccati

5. REPORT_DIAGNOSI_DGD_GASTRO.md (8.1KB)
   Report completo in formato Markdown

6. RIEPILOGO_DIAGNOSI_DGD.txt (questo file)
   Riepilogo testuale della diagnosi

================================================================================
PROSSIMI PASSI CONSIGLIATI
================================================================================

1. IMMEDIATO:
   Rimuovere il filtro customer_rank > 0 dalla riga 114 di:
   C:\Users\lapa\OneDrive\Desktop\Claude Code\app\api\clienti\search\route.ts

2. OPZIONALE:
   Aggiungere un toggle UI "Solo clienti attivi" in CustomerSelector.tsx
   per permettere agli utenti di filtrare manualmente

3. IMPORTANTE:
   Verificare la qualità dei dati con i 3360 clienti con customer_rank = 0
   - Alcuni potrebbero essere duplicati
   - Altri potrebbero essere test/demo
   - Molti potrebbero essere clienti legittimi mai attivati

================================================================================
Fine report
================================================================================
